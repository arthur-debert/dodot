# Test Failure Categorization for V2 Migration

## Summary
- Total failing packages: 12
- Build failures: 8 packages
- Test failures: 4 packages
- Passing packages: 26

## Categories

### 1. DELETE - Tests for removed V1 functionality

#### Action System Tests (old Action types, GetActions, ActionResult)
- pkg/core/dodotignore_integration_test.go - References GetActions() (line 78)
- pkg/state/dangling_test.go - Uses old Action types extensively
- pkg/types/types_test.go - Tests old Action struct
- pkg/types/results_test.go - Tests ActionResult type
- pkg/registry/global_test.go - References types.Action

#### Old Handler Constructor Tests
- pkg/handlers/homebrew/homebrew_template_test.go - Uses NewHomebrewHandler()
- pkg/handlers/homebrew/integration_test.go - Uses NewHomebrewHandler(), GetHomebrewSentinelPath()
- pkg/handlers/provision/integration_test.go - Uses NewProvisionScriptHandler()
- pkg/handlers/symlink/integration_test.go - Uses NewSymlinkHandler()
- pkg/handlers/symlink/symlink_runmode_test.go - Uses NewSymlinkHandler()

### 2. SKIP - Tests for temporarily disabled features

#### Unlink Command Tests
- pkg/commands/unlink/unlink_test.go - Entire unlink command is disabled
  - Missing function: removeIfExists (line 381)

#### Status Command Tests
- pkg/commands/status/status_test.go - Entire status command is disabled
  - All status tests fail because command is not implemented

### 3. FIX - Tests that should work with V2 but need updates

#### Fill Command Tests
- pkg/commands/fill/fill_test.go - Test failures but no build errors
  - Tests expect files to be created (install.sh, Brewfile) but V2 may not create them
  - Need to update expectations to match V2 behavior

#### Initialize Command Tests
- pkg/commands/initialize/initialize_test.go - Test failures but no build errors
  - "create_a_new_pack" test fails - likely expects different file creation behavior in V2
  - Other tests pass (pack_already_exists, invalid_pack_name)

#### Matcher Tests
- pkg/matchers/matchers_test.go - Tests pass (utility functions work)
- pkg/matchers/matchers_integration_test.go - TestCreateMatcher/TestValidateMatcher fail
  - Failure: "unknown handler: symlink" - handlers not registered in test setup
  - Need to register V2 handlers before running tests

### 4. WORKING - Tests that already pass

#### V2 Handler Tests (already exist and may work)
- pkg/handlers/homebrew/homebrew_v2_test.go
- pkg/handlers/path/path_v2_test.go
- pkg/handlers/provision/provision_v2_test.go
- pkg/handlers/shell_profile/shell_profile_v2_test.go
- pkg/handlers/symlink/symlink_v2_test.go

#### Core V2 Tests
- pkg/core/actions_v2_test.go
- pkg/types/action_v2_test.go

#### Fully Passing Packages
- cmd/dodot
- pkg/cobrax/topics
- pkg/commands/addignore
- pkg/commands/adopt
- pkg/commands/internal
- pkg/commands/link
- pkg/commands/list
- pkg/commands/provision
- pkg/config
- pkg/datastore
- pkg/display
- pkg/errors
- pkg/executor
- pkg/filesystem
- pkg/handlers/path
- pkg/handlers/shell_profile
- pkg/internal/hashutil
- pkg/lipbalm
- pkg/logging
- pkg/output
- pkg/output/styles
- pkg/packs
- pkg/paths
- pkg/shell
- pkg/testutil
- pkg/triggers

## Recommendations

1. **DELETE Category**: Remove all tests that reference old V1 functionality:
   - Remove or update tests using old Action types
   - Remove tests for old handler constructors
   - Consider archiving these tests if needed for reference

2. **SKIP Category**: Add skip annotations or remove entirely:
   - Unlink command tests - skip until command is re-enabled
   - Status command tests - skip until command is re-enabled

3. **FIX Category**: Update to work with V2:
   - Fill command tests - update to use V2 pipeline
   - Initialize command tests - update to use V2 pipeline
   - Matcher tests - investigate specific failures

4. **WORKING Category**: Verify V2 tests are actually running:
   - Ensure V2 handler tests are properly integrated
   - Consider consolidating V2 tests with main test files

## Specific Actions by File

### Files to DELETE
```bash
# Remove old Action system tests
rm pkg/state/dangling_test.go
rm pkg/types/types_test.go  # Or update to remove Action references
rm pkg/types/results_test.go  # Or update to remove ActionResult references
rm pkg/registry/global_test.go  # Or update to remove Action references

# Remove old handler constructor tests
rm pkg/handlers/homebrew/homebrew_template_test.go
rm pkg/handlers/homebrew/integration_test.go
rm pkg/handlers/provision/integration_test.go
rm pkg/handlers/symlink/integration_test.go
rm pkg/handlers/symlink/symlink_runmode_test.go

# Update to remove GetActions reference
# In pkg/core/dodotignore_integration_test.go - remove line 78 and related code
```

### Files to SKIP
```bash
# Add skip to entire test files or remove
rm -rf pkg/commands/unlink/  # Or add t.Skip() to all tests
rm -rf pkg/commands/status/  # Or add t.Skip() to all tests
```

### Files to FIX
```bash
# pkg/commands/fill/fill_test.go
# - Update test expectations to match V2 behavior
# - May not create install.sh and Brewfile anymore

# pkg/commands/initialize/initialize_test.go  
# - Fix "create_a_new_pack" test to match V2 expectations

# pkg/matchers/matchers_integration_test.go
# - Add handler registration in TestMain or setup functions
# - Import and register V2 handlers before tests run
```

### Files to VERIFY
```bash
# V2 tests that ARE working:
# ✅ pkg/handlers/path/path_v2_test.go - PASSES
# ✅ pkg/handlers/shell_profile/shell_profile_v2_test.go - PASSES

# V2 tests blocked by other failures:
# ❌ pkg/handlers/homebrew/homebrew_v2_test.go - blocked by homebrew_template_test.go
# ❌ pkg/handlers/provision/provision_v2_test.go - blocked by integration_test.go
# ❌ pkg/handlers/symlink/symlink_v2_test.go - blocked by other symlink tests
# ❌ pkg/core/actions_v2_test.go - blocked by dodotignore_integration_test.go
# ❌ pkg/types/action_v2_test.go - blocked by types_test.go and results_test.go
```

## Priority Actions

1. **First Wave - Remove blockers**:
   - Delete all files in "Files to DELETE" section
   - This will unblock V2 tests from running

2. **Second Wave - Skip disabled features**:
   - Remove or skip unlink and status command tests

3. **Third Wave - Fix remaining tests**:
   - Fix fill command tests
   - Fix initialize command tests  
   - Fix matcher integration tests (add handler registration)

4. **Fourth Wave - Verify V2 tests**:
   - Run all V2 tests to ensure they pass
   - Consider merging V2 tests back into main test files