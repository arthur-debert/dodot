FROM ubuntu:latest

# Install dependencies
RUN apt-get update && apt-get install -y \
    curl \
    sudo \
    man-db \
    && rm -rf /var/lib/apt/lists/*

# Copy the .deb file
COPY dist/*.deb /tmp/

# Install the package
RUN dpkg -i /tmp/*.deb || apt-get install -f -y

# Test the installation
RUN which dodot
RUN dodot --version
RUN dodot --help

# Test completions are installed
RUN test -f /usr/share/bash-completion/completions/dodot
RUN test -f /usr/share/zsh/site-functions/_dodot
RUN test -f /usr/share/fish/vendor_completions.d/dodot.fish

# Test man page is installed
RUN test -f /usr/share/man/man1/dodot.1.gz
RUN man dodot | head -n 5

CMD ["dodot", "--help"]