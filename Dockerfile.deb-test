FROM ubuntu:latest

# Install dependencies
RUN apt-get update && apt-get install -y \
    curl \
    sudo \
    man-db \
    && rm -rf /var/lib/apt/lists/*

# Copy the .deb file
COPY dist/*.deb /tmp/

# Install the package
RUN dpkg -i /tmp/*.deb || apt-get install -f -y

# Test the installation
RUN which my-awesome-cli
RUN my-awesome-cli --version
RUN my-awesome-cli --help

# Test completions are installed
RUN test -f /usr/share/bash-completion/completions/my-awesome-cli
RUN test -f /usr/share/zsh/site-functions/_my-awesome-cli
RUN test -f /usr/share/fish/vendor_completions.d/my-awesome-cli.fish

# Test man page is installed
RUN test -f /usr/share/man/man1/my-awesome-cli.1.gz
RUN man my-awesome-cli | head -n 5

CMD ["my-awesome-cli", "--help"]