#!/usr/bin/env bash
set -euo pipefail

# Build output directory (matching main build script)
BIN_DIR="bin"
COMPLETIONS_DIR="completions"

# Create completions directory
mkdir -p "${COMPLETIONS_DIR}"

# Always build for the current platform to ensure compatibility
if [ ! -f "${BIN_DIR}/dodot" ]; then
    echo "Building dodot for current platform..."
    ./scripts/build
fi
DODOT_BIN="${BIN_DIR}/dodot"

# Generate completions
echo "Generating bash completion..."
"${DODOT_BIN}" completion bash > "${COMPLETIONS_DIR}/dodot.bash"

echo "Generating zsh completion..."
"${DODOT_BIN}" completion zsh > "${COMPLETIONS_DIR}/_dodot"

echo "Generating fish completion..."
"${DODOT_BIN}" completion fish > "${COMPLETIONS_DIR}/dodot.fish"

echo "âœ… Completions generated in ${COMPLETIONS_DIR}/"